lisp-goodies> make
emacsclient -e '(progn (load "/home/shalaev/Private/work/lisp-goodies/helpers/derive-version.el") (format-version "change-log.org"))' | xargs > version.org

Now emacs is probably waiting for your responce...
emacsclient -e '(progn (load "/home/shalaev/Private/work/lisp-goodies/helpers/derive-version.el") (printangle "shalaev.org"))' | xargs > generated/from/shalaev.org
sed "s/the-version/`head -n1 version.org`/" header.el > packaged/shalaev.el
cat generated/cl.el  generated/file-functions.el generated/functions.el generated/logging.el generated/macros.el >> packaged/shalaev.el
echo "(provide 'shalaev)" >> packaged/shalaev.el
echo ";;; shalaev.el ends here" >> packaged/shalaev.el
emacsclient -e '(untilde (cdr (assoc "local-packages" package-archives)))' | xargs cp packaged/shalaev.el
echo ";; -*- lexical-binding: t; -*-" > packaged/start.el
echo "\n;; I load this file at startup\n"  >> packaged/start.el
cat generated/local-packages.el generated/make.el generated/load.el >> packaged/start.el
echo ";; -*- lexical-binding: t; -*-" > packaged/start.el
echo "\n;; This file is a part of https://github.com/chalaev/lisp-goodies"  >> packaged/start.el
echo "\n;; I load this file at startup\n"  >> packaged/start.el
cat generated/local-packages.el generated/make.el generated/load.el >> packaged/start.el
for d in ../*/goodies/ ; do rsync -avu packaged/start.el $d ; done
sending incremental file list
start.el

sent 2,850 bytes  received 35 bytes  5,770.00 bytes/sec
total size is 2,747  speedup is 0.95
sending incremental file list
start.el

sent 2,850 bytes  received 35 bytes  5,770.00 bytes/sec
total size is 2,747  speedup is 0.95
sending incremental file list
start.el

sent 2,850 bytes  received 35 bytes  5,770.00 bytes/sec
total size is 2,747  speedup is 0.95
sending incremental file list
start.el

sent 2,850 bytes  received 35 bytes  5,770.00 bytes/sec
total size is 2,747  speedup is 0.95
sending incremental file list
start.el

sent 2,850 bytes  received 35 bytes  5,770.00 bytes/sec
total size is 2,747  speedup is 0.95
cp packaged/start.el ~/.emacs.d/batch-start.el
[ -d $HOME/quicklisp/local-projects/shalaev/ ] || mkdir -p $HOME/quicklisp/local-projects/shalaev/

Now emacs is probably waiting for your responce...
emacsclient -e '(progn (load "/home/shalaev/Private/work/lisp-goodies/helpers/derive-version.el") (printangle "headers.org"))' | xargs > generated/from/headers.org
cat generated/headers/macros.lisp generated/macros.lisp > $HOME/quicklisp/local-projects/shalaev/macros.lisp
cat generated/headers/files.lisp generated/files.lisp > $HOME/quicklisp/local-projects/shalaev/files.lisp
cat generated/headers/tests.lisp generated/tests.lisp > $HOME/quicklisp/local-projects/shalaev/tests.lisp
cat generated/headers/shalaev.lisp generated/shalaev.lisp > $HOME/quicklisp/local-projects/shalaev/shalaev.lisp
cat shalaev.asd > $HOME/quicklisp/local-projects/shalaev/shalaev.asd
cat version.org > $HOME/quicklisp/local-projects/shalaev/version.org

Now emacs is probably waiting for your responce...
emacsclient -e '(progn (load "/home/shalaev/Private/work/lisp-goodies/helpers/derive-version.el") (printangle "packaging.org"))' | xargs > generated/from/packaging.org
emacsclient -e '(progn (find-file "README.org") (org-md-export-to-markdown))'
"README.md"
sed -i "s/\.md)/.org)/g"  README.md

Testing before we package it:
emacs -q --no-site-file --batch -l ert -l packaged/start.el -l generated/macros.el -l generated/functions.el -l generated/file-functions.el -l generated/load.el -l generated/cl.el -l generated/tests.el -f ert-run-tests-batch-and-exit 2> generated/el-tests.log
12/29 13:37 EL TESTS PASSED :)

tar jcfv packaged/el-shalaev.tbz --transform s/^generated/shalaev/ generated/*.el
generated/2.el
generated/cl.el
generated/file-functions.el
generated/functions.el
generated/load.el
generated/local-packages.el
generated/logging.el
generated/macros.el
generated/make.el
generated/tests.el

Testing before we package it:
This is SBCL 2.0.10, an implementation of ANSI Common Lisp.
More information about SBCL is available at <http://www.sbcl.org/>.

SBCL is free software, provided as is, with absolutely no warranty.
It is mostly in the public domain; some portions are provided under
BSD-style licenses.  See the CREDITS and COPYING files in the
distribution for more information.
; compiling file "/home/shalaev/quicklisp/local-projects/shalaev/macros.lisp" (written 29 DEC 2020 01:37:06 PM):
; processing (DEFPACKAGE :SHALAEV/MACROS ...)
; processing (IN-PACKAGE :SHALAEV/MACROS)
; processing (DEFMACRO COND-LET ...)
; processing (DEFMACRO WHEN-LET ...)
; processing (DEFMACRO IF-LET ...)
; processing (DEFMACRO IFN-LET ...)
; processing (DEFMACRO NEEDS ...)
; processing (DEFMACRO IFF ...)
; processing (DEFMACRO IFN ...)
; processing (DEFMACRO CONCAT ...)
; processing (DEFMACRO ASET ...)
; processing (DEFMACRO HSET ...)

; wrote /home/shalaev/.cache/common-lisp/sbcl-2.0.10-linux-x64/home/shalaev/quicklisp/local-projects/shalaev/macros-tmpGHU3ALSV.fasl
; compilation finished in 0:00:00.028
; compiling file "/home/shalaev/quicklisp/local-projects/shalaev/files.lisp" (written 29 DEC 2020 01:37:06 PM):
; processing (DEFPACKAGE :SHALAEV/FILES ...)
; processing (IN-PACKAGE :SHALAEV/FILES)
; processing (DEFUN RMDIR ...)
; processing (DEFUN ECHO-TO-FILE ...)
; processing (DEFUN MERGE-PATHS ...)

; wrote /home/shalaev/.cache/common-lisp/sbcl-2.0.10-linux-x64/home/shalaev/quicklisp/local-projects/shalaev/files-tmpAAURSO1.fasl
; compilation finished in 0:00:00.008
; compiling file "/home/shalaev/quicklisp/local-projects/shalaev/shalaev.lisp" (written 29 DEC 2020 01:37:06 PM):
; processing (DEFPACKAGE :SHALAEV ...)
; processing (IN-PACKAGE :SHALAEV)
; processing (DECLAIM (OPTIMIZE # ...))

; wrote /home/shalaev/.cache/common-lisp/sbcl-2.0.10-linux-x64/home/shalaev/quicklisp/local-projects/shalaev/shalaev-tmp5GEXGEG5.fasl
; compilation finished in 0:00:00.000
; compiling file "/home/shalaev/quicklisp/local-projects/shalaev/tests.lisp" (written 29 DEC 2020 01:37:06 PM):
; processing (DEFPACKAGE :SHALAEV/TESTS ...)
; processing (IN-PACKAGE :SHALAEV/TESTS)
; processing (DEFVAR N-FAILED ...)
; processing (DEFUN RUN-TESTS ...)
; processing (DECLAIM (NOTINLINE ID))
; processing (DEFUN ID ...)
; processing (DEFTEST WHEN-LET ...)
; processing (DEFTEST IF-LET ...)
; processing (DEFTEST CONCAT ...)
; processing (DEFTEST ASET ...)
; processing (DEFTEST HSET ...)

; wrote /home/shalaev/.cache/common-lisp/sbcl-2.0.10-linux-x64/home/shalaev/quicklisp/local-projects/shalaev/tests-tmpAR3FSGEY.fasl
; compilation finished in 0:00:00.004
Doing 5 pending tests of 5 tests total.
 SHALAEV/MACROS:WHEN-LET SHALAEV/MACROS:IF-LET SHALAEV/MACROS:CONCAT
 SHALAEV/MACROS:ASET SHALAEV/MACROS:HSET
No tests failed.
Doing 5 pending tests of 5 tests total.
 SHALAEV/MACROS:WHEN-LET SHALAEV/MACROS:IF-LET SHALAEV/MACROS:CONCAT
 SHALAEV/MACROS:ASET SHALAEV/MACROS:HSET
No tests failed.

12/29 13:37 CL TESTS PASSED :)

tar jcfv packaged/cl-shalaev.tbz --directory=$HOME/quicklisp/local-projects/shalaev/..  shalaev
shalaev/
shalaev/tests.lisp
shalaev/version.org
shalaev/shalaev.lisp
shalaev/files.lisp
shalaev/macros.lisp
shalaev/shalaev.asd
rm generated/from/headers.org
